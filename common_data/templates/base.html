{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{% block title%}{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'common_data/js/jquery-ui-1.12.1.custom/jquery-ui.theme.css' %}">
    <link rel="stylesheet" href="{% static 'common_data/js/jquery-ui-1.12.1.custom/jquery-ui.structure.css' %}">
    <link rel="stylesheet" type="text/css" media="screen" href="{% static 'common_data/css/bootstrap/css/bootstrap.min.css' %}" />
   
    
    <link rel="stylesheet" type="text/css" 
        href="{% static 'common_data/assets/css/all.min.css' %}" />
    <link rel="stylesheet" type="text/css" 
        href="{% static 'common_data/css/hover-min.css' %}" />
    <link rel="stylesheet" type="text/css" 
        href="{% static 'common_data/css/animate.css' %}" />
    
    
    <link rel="stylesheet" type='text/css' href="{% static 'common_data/css/suave.css' %}">
    <script type="text/javascript" src="{% static 'common_data/js/jquery-3.3.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'common_data/js/popper.js' %}"></script>
    
    <script type="text/javascript" src="{% static 'common_data/js/jquery-ui-1.12.1.custom/jquery-ui.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'common_data/css/bootstrap/js/bootstrap.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'common_data/js/jquery.form.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'common_data/js/pygal-tooltips.min.js' %}"></script>
    {% block head %}{% endblock %}
</head>
<body>
    <div>
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-info">
                    {{message}}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
            {% endfor %}
        
        {% endif %}
    </div>
    {% block window %}{% endblock %}
    <script type="text/javascript" src="{% static 'common_data/js/async_select.js' %}"></script>
<style>
    

    
    .notification-overlay {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(220,220,220,0.3);
    }


    .notification {
        border: 3px solid #007bff;
        border-radius: 20px;
        background-color: #ccc;
        margin: 100px auto;
        padding: 20px;
        width: 40%;
        height: 50%;
    }

    .notification h4 {
        font-weight: 250;
    }

</style>

{% include 'iframe_window.html' %}


<div>
<!-- The notification overlay -->
    <div class="notification-overlay">
        <div class="notification">
            <h4 id="notification-title">Notification Message</h4>
            <p  id="notification-timestamp">00:00</p>
            <hr class="my2">
            <p id="notification-message">Message</p>
            <div class="btn-group" role="group" style="float:right;">
                <button type="button" id="notification-dismiss" class="btn btn-primary">Dismiss</button>
            </div>
        </div>    
    </div>
    
        
</div>
<script>
    //iframe redirect detection
    

       $(".ui-date-picker").datepicker({
        changeYear: true,
        dateFormat: 'yy-mm-dd' 
        });
    

    
    function updateNotifications(){
        $.ajax({
            'method': 'GET',
            'url': '/messaging/api/notifications'
        }).then(function (data){
            if(data.unread > 0){
                $('#notification-title').text(data.latest.title);
                $('#notification-timestamp').text(data.latest.stamp);
                $('#notification-message').text(data.latest.message);
                $('#notification-dismiss').attr({
                    'onclick': "$.get('/messaging/api/notifications/mark-read/" + data.latest.id + "')"
                });

                 $('.notification-overlay').show(500);

            }
        })
    }
    function setNavbarActive(){
        var url = window.location.href;
        if(url.search('invoicing') !== -1){
            $("#sales").addClass('active')
        }else if(url.search('inventory') !== -1){
            $("#inventory").addClass('active')
        }else if(url.search('services') !== -1){
            $("#services").addClass('active')
        }else if(url.search('accounting') !== -1){
            $("#accounting").addClass('active')
        }else if(url.search('employees') !== -1){
            $("#employees").addClass('active')
        }else if(url.search('messaging') !== -1){
            $("#inbox").addClass('active')
        }else if(url.search('planner') !== -1){
            $("#planner").addClass('active')
        }
    }

    $(document).ready(function(){
        setNavbarActive()
        updateNotifications();
        setInterval(updateNotifications, 60000)
     
     
     $('.notification-overlay').click(function(){
         $('.notification-overlay').hide()
     })
     
    })


</script>
</body>
</html>

