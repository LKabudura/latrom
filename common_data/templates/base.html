{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{%block title%}{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'common_data/js/jquery-ui-1.12.1.custom/jquery-ui.theme.css' %}">
    <link rel="stylesheet" href="{% static 'common_data/js/jquery-ui-1.12.1.custom/jquery-ui.structure.css' %}">
    <link rel="stylesheet" type="text/css" media="screen" href="{% static 'common_data/css/bootstrap/css/bootstrap.min.css' %}" />
    
    
    <link rel="stylesheet" type="text/css" 
        href="{% static 'common_data/assets/css/all.min.css' %}" />
    
    
    <link rel="stylesheet" type='text/css' href="{% static 'common_data/css/invoice.css' %}">
    <script type="text/javascript" src="{% static 'common_data/js/jquery-3.3.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'common_data/js/popper.js' %}"></script>
    <script type="text/javascript" src="{% static 'common_data/js/jquery-ui-1.12.1.custom/jquery-ui.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'common_data/css/bootstrap/js/bootstrap.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'common_data/js/jquery.form.min.js' %}"></script>
    {% block head %}{% endblock %}
</head>
<body>
    <div>
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-info">
                    {{message}}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
            {% endfor %}
        
        {% endif %}
    </div>
    {% block window %}{% endblock %}
<style>
    .my-modal{
        display: none;
        position: fixed;
        z-index: 100;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0,0,0);
        background-color: rgba(0,0,0,0.4);
    } 

    .modal-content{
        background-color: #eee;
        margin: 20px auto;
        padding: 20px;
        width: 80%;
        height: 80%;
    }   

    .frame-style {
        width: 100%;
        height: 100%
    }

    
    .notification-overlay {
        display:none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,112,255,0.3);
    }

    

    .notification {
        background-color: #007bff;
        margin: 100px auto;
        padding: 20px;
        width: 40%;
        height: 50%;
    }

</style>
<div class="my-modal" id="id-my-modal">
    <div class="modal-content">
        <iframe class="frame-style" frameborder="0" id="popup-frame" src=""></iframe>
    </div>
</div>    

<div>
<!-- The notification overlay -->
    <div class="notification-overlay">
        <div class="notification">
            <h4 class="text-white" id="notification-title">Notification Message</h4>
            <p class="text-white"  id="notification-timestamp">00:00</p>
            <hr class="my2">
            <p class="text-white" id="notification-message">Message</p>
            <div class="btn-group" role="group" style="float:right;">
                <button type="button" class="btn btn-info">Take Action</button>
                <button type="button" id="notification-dismiss" class="btn btn-info">Dismiss</button>
            </div>
        </div>    
    </div>
    
        
</div>
<script>
    var modal = document.getElementById('id-my-modal');
    
    window.onclick = function(evt){
        if(evt.target == modal){
        modal.style.display = 'none';
        }
    }

    function inIframe () {
        try {
            return window.self !== window.top;
        } catch (e) {
            return true;
        }
    }
    function updateNotifications(){
        $.ajax({
            'method': 'GET',
            'url': '/messaging/api/notifications'
        }).then(function (data){
            if(data.unread > 0){
                $('#notification-title').text(data.latest.title);
                $('#notification-timestamp').text(data.latest.stamp);
                $('#notification-message').text(data.latest.message);
                $('#notification-dismiss').attr({
                    'onclick': "$.get('/messaging/api/notifications/mark-read/" + data.latest.id + "')"
                });

                 $('.notification-overlay').show(500);

            }
        })
    }



    $(document).ready(function(){
     if(inIframe()){
         $("#navbar").hide();
         $("#footer").hide();
     }
     var updater = setInterval(updateNotifications, 10000)   
     $('.notification-overlay').click(function(){
         $('.notification-overlay').hide()
     })
     
    })
</script>
</body>
</html>

